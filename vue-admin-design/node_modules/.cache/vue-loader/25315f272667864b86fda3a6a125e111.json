{"remainingRequest":"D:\\projectWork\\thirdGrade\\econmic\\vue-admin-design\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\projectWork\\thirdGrade\\econmic\\vue-admin-design\\src\\components\\TextSetting\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\projectWork\\thirdGrade\\econmic\\vue-admin-design\\src\\components\\TextSetting\\index.vue","mtime":1728976157717},{"path":"D:\\projectWork\\thirdGrade\\econmic\\vue-admin-design\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1728977241680},{"path":"D:\\projectWork\\thirdGrade\\econmic\\vue-admin-design\\node_modules\\babel-loader\\lib\\index.js","mtime":1728977243261},{"path":"D:\\projectWork\\thirdGrade\\econmic\\vue-admin-design\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1728977241680},{"path":"D:\\projectWork\\thirdGrade\\econmic\\vue-admin-design\\node_modules\\vue-loader\\lib\\index.js","mtime":1728977244061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgeyBiYXNlNjR0b0Jsb2IgfSBmcm9tICdAL3V0aWxzJw0KaW1wb3J0IEltYWdlUmljaFRleHQgZnJvbSAnLi4vSW1hZ2VSaWNoVGV4dCcNCg0KY29uc3QgZm9udEZhbWlseURhdGEgPSBbDQogIHsgdmFsdWU6ICfpu5HkvZMnIH0sDQogIHsgdmFsdWU6ICflrovkvZMnIH0sDQogIHsgdmFsdWU6ICfku7/lrosnIH0sDQogIHsgdmFsdWU6ICfmpbfkvZMnIH0sDQogIHsgdmFsdWU6ICfpmrbkuaYnIH0sDQogIHsgdmFsdWU6ICflvq7ova/pm4Xpu5EnIH0sDQogIHsgdmFsdWU6ICfmlrnmraPlp5rkvZMnIH0NCl0NCmNvbnN0IGZvbnRTaXplRGF0YSA9IFsNCiAgeyB2YWx1ZTogJzEycHgnIH0sDQogIHsgdmFsdWU6ICcxNHB4JyB9LA0KICB7IHZhbHVlOiAnMTZweCcgfSwNCiAgeyB2YWx1ZTogJzE4cHgnIH0sDQogIHsgdmFsdWU6ICcyNHB4JyB9LA0KICB7IHZhbHVlOiAnMzJweCcgfSwNCiAgeyB2YWx1ZTogJzQ4cHgnIH0NCl0NCg0KZXhwb3J0IGRlZmF1bHQgew0KICBuYW1lOiAnVGV4dFNldHRpbmcnLA0KICBjb21wb25lbnRzOiB7IEltYWdlUmljaFRleHQgfSwNCiAgcHJvcHM6IHsNCiAgICBhY3RpdmVFbGVUZXh0OiB7DQogICAgICB0eXBlOiBPYmplY3QsDQogICAgICBkZWZhdWx0OiAoKSA9PiB7fQ0KICAgIH0NCiAgfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgZm9udEZhbWlseURhdGEsDQogICAgICBmb250U2l6ZURhdGENCiAgICB9DQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgLy8g5a2X5L2T5piv5ZCm5Yqg57KXDQogICAgZm9udFdlaWdodCgpIHsNCiAgICAgIGlmICgrdGhpcy5hY3RpdmVFbGVUZXh0LnN0eWxlLmZvbnRXZWlnaHQgPT09IDQwMCkgew0KICAgICAgICByZXR1cm4gZmFsc2UNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiB0cnVlDQogICAgICB9DQogICAgfQ0KICB9LA0KICB3YXRjaDogew0KICAgIC8vIOaWh+Wtl+Wkp+Wwj+WPmOWMluaXtuihjOmrmOS4gOi1t+WPmOWMlg0KICAgIGFjdGl2ZUVsZVRleHQ6IHsNCiAgICAgIGhhbmRsZXIodmFsKSB7DQogICAgICAgIHRoaXMuYWN0aXZlRWxlVGV4dC5zdHlsZS5saW5lSGVpZ2h0ID0gdmFsLnN0eWxlLmZvbnRTaXplDQogICAgICB9LA0KICAgICAgZGVlcDogdHJ1ZQ0KICAgIH0NCiAgfSwNCiAgbWV0aG9kczogew0KICAgIC8vIOiuvue9rueyl+S9kw0KICAgIHNldEZvbnRXZWlnaHQoKSB7DQogICAgICBpZiAoK3RoaXMuYWN0aXZlRWxlVGV4dC5zdHlsZS5mb250V2VpZ2h0ID09PSA0MDApIHsNCiAgICAgICAgdGhpcy5hY3RpdmVFbGVUZXh0LnN0eWxlLmZvbnRXZWlnaHQgPSA2MDANCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuYWN0aXZlRWxlVGV4dC5zdHlsZS5mb250V2VpZ2h0ID0gNDAwDQogICAgICB9DQogICAgfSwNCiAgICAvLyDorr7nva7lr7npvZANCiAgICBoYW5kbGVDb21tYW5kKGNvbW1hbmQpIHsNCiAgICAgIHRoaXMuYWN0aXZlRWxlVGV4dC5zdHlsZS50ZXh0QWxpZ24gPSBjb21tYW5kDQogICAgfSwNCiAgICAvLyDlvZPliY3lr7npvZDmlrnlvI8NCiAgICBzZXRBbGlnbkFjdGl2ZSh0eXBlKSB7DQogICAgICBpZiAodGhpcy5hY3RpdmVFbGVUZXh0LnN0eWxlLnRleHRBbGlnbiA9PT0gdHlwZSkgew0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyM0MDllZmYnLA0KICAgICAgICAgIGNvbG9yOiAnI2ZmZicNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcnLA0KICAgICAgICAgIGNvbG9yOiAnIzMzMycNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g5paH5pys55Sf5oiQ5Zu+54mHDQogICAgdGV4dEJlY29tZUltZyhvYmopIHsNCiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpDQogICAgICBjYW52YXMud2lkdGggPSBvYmoudw0KICAgICAgY2FudmFzLmhlaWdodCA9IG9iai5oDQogICAgICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJykNCiAgICAgIC8vIOe7mOWItuWtl+S9k+i3neemu2NhbnZhc+mhtumDqOWIneWni+eahOmrmOW6pg0KICAgICAgY29uc3QgaW5pdFRvcCA9IDQNCiAgICAgIGNvbnN0IGluaXRMZWZ0ID0gOA0KICAgICAgLy8g6K6+572u6IOM5pmv6ImyDQogICAgICBjb250ZXh0LmZpbGxTdHlsZSA9IG9iai5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgfHwgJ3RyYW5zcGFyZW50Jw0KICAgICAgY29udGV4dC5maWxsUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpDQogICAgICAvLyDorr7nva7mlofmnKzmoLflvI8NCiAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gb2JqLnN0eWxlLmNvbG9yDQogICAgICBjb250ZXh0LmZvbnQgPSBvYmouc3R5bGUuZm9udFdlaWdodCArICcgJyArIG9iai5zdHlsZS5mb250U2l6ZSArICcgJyArIG9iai5zdHlsZS5mb250RmFtaWx5DQogICAgICBjb250ZXh0LnRleHRCYXNlbGluZSA9ICd0b3AnDQogICAgICAvLyDorr7nva7mlofmnKzlr7npvZDmlrnlvI8NCiAgICAgIGNvbnRleHQudGV4dEFsaWduID0gb2JqLnN0eWxlLnRleHRBbGlnbg0KDQogICAgICBjb25zdCB0ZXh0QXJyID0gb2JqLnRleHQuc3BsaXQoJycpDQogICAgICBsZXQgdGVtcFN0ciA9ICcnDQogICAgICBjb25zdCByb3dBcnIgPSBbXQ0KICAgICAgY29uc3QgbWF4VGV4dFdpZHRoID0gY2FudmFzLndpZHRoIC0gMiAqIGluaXRMZWZ0DQoNCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGV4dEFyci5sZW5ndGg7IGkrKykgew0KICAgICAgICBpZiAoY29udGV4dC5tZWFzdXJlVGV4dCh0ZW1wU3RyKS53aWR0aCA8IG1heFRleHRXaWR0aCAmJiBjb250ZXh0Lm1lYXN1cmVUZXh0KHRlbXBTdHIgKyAodGV4dEFycltpXSkpLndpZHRoIDw9IG1heFRleHRXaWR0aCkgew0KICAgICAgICAgIHRlbXBTdHIgKz0gdGV4dEFycltpXQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJvd0Fyci5wdXNoKHRlbXBTdHIpDQogICAgICAgICAgdGVtcFN0ciA9IHRleHRBcnJbaV0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcm93QXJyLnB1c2godGVtcFN0cikNCg0KICAgICAgbGV0IGRyYXdMZWZ0DQogICAgICBpZiAoY29udGV4dC50ZXh0QWxpZ24gPT09ICdsZWZ0Jykgew0KICAgICAgICBkcmF3TGVmdCA9IGluaXRMZWZ0DQogICAgICB9IGVsc2UgaWYgKGNvbnRleHQudGV4dEFsaWduID09PSAnY2VudGVyJykgew0KICAgICAgICBkcmF3TGVmdCA9IG1heFRleHRXaWR0aCAvIDINCiAgICAgIH0gZWxzZSBpZiAoY29udGV4dC50ZXh0QWxpZ24gPT09ICdyaWdodCcpIHsNCiAgICAgICAgZHJhd0xlZnQgPSBtYXhUZXh0V2lkdGgNCiAgICAgIH0NCg0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb3dBcnIubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgY29udGV4dC5maWxsVGV4dChyb3dBcnJbaV0sIGRyYXdMZWZ0LCAocGFyc2VJbnQob2JqLnN0eWxlLmZvbnRTaXplKSAqIGkgKyBpbml0VG9wKSwgbWF4VGV4dFdpZHRoKQ0KICAgICAgfQ0KDQogICAgICByZXR1cm4gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJykNCiAgICB9LA0KICAgIC8vIOS4i+i9veeUn+aIkOeahOWbvueJhw0KICAgIGRvd25sb2FkSW1hZ2UoKSB7DQogICAgICBjb25zdCBpbWFnZUJhc2U2NCA9IHRoaXMudGV4dEJlY29tZUltZyh0aGlzLmFjdGl2ZUVsZVRleHQpDQogICAgICBjb25zdCBpbWFnZUJsb2IgPSBiYXNlNjR0b0Jsb2IoaW1hZ2VCYXNlNjQpDQogICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpDQogICAgICBjb25zdCBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdIVE1MRXZlbnRzJykNCiAgICAgIC8vIGluaXRFdmVudCDkuI3liqDlkI7kuKTkuKrlj4LmlbDkvJrlnKjngavni5DkuIvmiqXplJkg5LqL5Lu257G75Z6L77yM5piv5ZCm5YaS5rOh77yM5piv5ZCm6Zi75q2i5rWP6KeI5Zmo55qE6buY6K6k6KGM5Li6DQogICAgICBldmVudC5pbml0RXZlbnQoJ2NsaWNrJywgdHJ1ZSwgdHJ1ZSkNCiAgICAgIGxpbmsuZG93bmxvYWQgPSAnaW1hZ2UucG5nJw0KICAgICAgbGluay5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChpbWFnZUJsb2IpDQogICAgICAvLyDlhbzlrrnngavni5ANCiAgICAgIGxpbmsuZGlzcGF0Y2hFdmVudChuZXcgTW91c2VFdmVudCgnY2xpY2snLCB7IGJ1YmJsZXM6IHRydWUsIGNhbmNlbGFibGU6IHRydWUsIHZpZXc6IHdpbmRvdyB9KSkNCiAgICB9DQogIH0NCn0NCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAuEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/TextSetting","sourcesContent":["<template>\r\n  <div class=\"text-setting-wrapper\">\r\n    <el-form label-width=\"70px\">\r\n      <!--文本-->\r\n      <el-form-item label=\"文本\">\r\n        <ImageRichText v-model=\"activeEleText.text\" class=\"text-editable\" :active-ele-text=\"activeEleText\" />\r\n      </el-form-item>\r\n      <!--字体-->\r\n      <el-form-item label=\"字体\">\r\n        <el-select v-model=\"activeEleText.style.fontFamily\" size=\"small\">\r\n          <el-option\r\n            v-for=\"item in fontFamilyData\"\r\n            :key=\"item.value\"\r\n            :label=\"item.value\"\r\n            :value=\"item.value\"\r\n            :style=\"{'fontFamily': item.value}\"\r\n          />\r\n        </el-select>\r\n      </el-form-item>\r\n      <!--字号-->\r\n      <el-form-item label=\"字号\">\r\n        <el-select\r\n          v-model=\"activeEleText.style.fontSize\"\r\n          size=\"small\"\r\n        >\r\n          <el-option\r\n            v-for=\"item in fontSizeData\"\r\n            :key=\"item.value\"\r\n            :label=\"item.value\"\r\n            :value=\"item.value\"\r\n          />\r\n        </el-select>\r\n      </el-form-item>\r\n      <!--颜色-->\r\n      <el-form-item label=\"颜色\">\r\n        <!-- 字体颜色 -->\r\n        <div class=\"color-box\">\r\n          <i class=\"vue-dsn-icon-wenzise color-icon\" :style=\"{'color': activeEleText.style.color}\" />\r\n          <el-color-picker v-model=\"activeEleText.style.color\" />\r\n        </div>\r\n        <!-- 背景颜色 -->\r\n        <div class=\"color-box\">\r\n          <i class=\"vue-dsn-icon-beijingse color-icon icon-bg\" :style=\"{'color': activeEleText.style.backgroundColor}\" />\r\n          <el-color-picker v-model=\"activeEleText.style.backgroundColor\" />\r\n        </div>\r\n        <div class=\"style-box\">\r\n          <!-- 加粗 -->\r\n          <span :class=\"['style-item', fontWeight ? 'active' : '']\" @click=\"setFontWeight\">\r\n            <i class=\"vue-dsn-icon-jiacu style-icon\" />\r\n          </span>\r\n          <!-- 对齐 -->\r\n          <div class=\"style-item\">\r\n            <el-dropdown trigger=\"click\" @command=\"handleCommand\">\r\n              <i class=\"vue-dsn-icon-duiqi style-icon\" />\r\n              <el-dropdown-menu slot=\"dropdown\">\r\n                <el-dropdown-item command=\"left\" :style=\"setAlignActive('left')\">左对齐</el-dropdown-item>\r\n                <el-dropdown-item command=\"center\" :style=\"setAlignActive('center')\">居中</el-dropdown-item>\r\n                <el-dropdown-item command=\"right\" :style=\"setAlignActive('right')\">右对齐</el-dropdown-item>\r\n              </el-dropdown-menu>\r\n            </el-dropdown>\r\n          </div>\r\n        </div>\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" @click=\"downloadImage\">文本生成图片</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { base64toBlob } from '@/utils'\r\nimport ImageRichText from '../ImageRichText'\r\n\r\nconst fontFamilyData = [\r\n  { value: '黑体' },\r\n  { value: '宋体' },\r\n  { value: '仿宋' },\r\n  { value: '楷体' },\r\n  { value: '隶书' },\r\n  { value: '微软雅黑' },\r\n  { value: '方正姚体' }\r\n]\r\nconst fontSizeData = [\r\n  { value: '12px' },\r\n  { value: '14px' },\r\n  { value: '16px' },\r\n  { value: '18px' },\r\n  { value: '24px' },\r\n  { value: '32px' },\r\n  { value: '48px' }\r\n]\r\n\r\nexport default {\r\n  name: 'TextSetting',\r\n  components: { ImageRichText },\r\n  props: {\r\n    activeEleText: {\r\n      type: Object,\r\n      default: () => {}\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      fontFamilyData,\r\n      fontSizeData\r\n    }\r\n  },\r\n  computed: {\r\n    // 字体是否加粗\r\n    fontWeight() {\r\n      if (+this.activeEleText.style.fontWeight === 400) {\r\n        return false\r\n      } else {\r\n        return true\r\n      }\r\n    }\r\n  },\r\n  watch: {\r\n    // 文字大小变化时行高一起变化\r\n    activeEleText: {\r\n      handler(val) {\r\n        this.activeEleText.style.lineHeight = val.style.fontSize\r\n      },\r\n      deep: true\r\n    }\r\n  },\r\n  methods: {\r\n    // 设置粗体\r\n    setFontWeight() {\r\n      if (+this.activeEleText.style.fontWeight === 400) {\r\n        this.activeEleText.style.fontWeight = 600\r\n      } else {\r\n        this.activeEleText.style.fontWeight = 400\r\n      }\r\n    },\r\n    // 设置对齐\r\n    handleCommand(command) {\r\n      this.activeEleText.style.textAlign = command\r\n    },\r\n    // 当前对齐方式\r\n    setAlignActive(type) {\r\n      if (this.activeEleText.style.textAlign === type) {\r\n        return {\r\n          backgroundColor: '#409eff',\r\n          color: '#fff'\r\n        }\r\n      } else {\r\n        return {\r\n          backgroundColor: '',\r\n          color: '#333'\r\n        }\r\n      }\r\n    },\r\n    // 文本生成图片\r\n    textBecomeImg(obj) {\r\n      const canvas = document.createElement('canvas')\r\n      canvas.width = obj.w\r\n      canvas.height = obj.h\r\n      const context = canvas.getContext('2d')\r\n      // 绘制字体距离canvas顶部初始的高度\r\n      const initTop = 4\r\n      const initLeft = 8\r\n      // 设置背景色\r\n      context.fillStyle = obj.style.backgroundColor || 'transparent'\r\n      context.fillRect(0, 0, canvas.width, canvas.height)\r\n      // 设置文本样式\r\n      context.fillStyle = obj.style.color\r\n      context.font = obj.style.fontWeight + ' ' + obj.style.fontSize + ' ' + obj.style.fontFamily\r\n      context.textBaseline = 'top'\r\n      // 设置文本对齐方式\r\n      context.textAlign = obj.style.textAlign\r\n\r\n      const textArr = obj.text.split('')\r\n      let tempStr = ''\r\n      const rowArr = []\r\n      const maxTextWidth = canvas.width - 2 * initLeft\r\n\r\n      for (let i = 0; i < textArr.length; i++) {\r\n        if (context.measureText(tempStr).width < maxTextWidth && context.measureText(tempStr + (textArr[i])).width <= maxTextWidth) {\r\n          tempStr += textArr[i]\r\n        } else {\r\n          rowArr.push(tempStr)\r\n          tempStr = textArr[i]\r\n        }\r\n      }\r\n      rowArr.push(tempStr)\r\n\r\n      let drawLeft\r\n      if (context.textAlign === 'left') {\r\n        drawLeft = initLeft\r\n      } else if (context.textAlign === 'center') {\r\n        drawLeft = maxTextWidth / 2\r\n      } else if (context.textAlign === 'right') {\r\n        drawLeft = maxTextWidth\r\n      }\r\n\r\n      for (let i = 0; i < rowArr.length; i++) {\r\n        context.fillText(rowArr[i], drawLeft, (parseInt(obj.style.fontSize) * i + initTop), maxTextWidth)\r\n      }\r\n\r\n      return canvas.toDataURL('image/png')\r\n    },\r\n    // 下载生成的图片\r\n    downloadImage() {\r\n      const imageBase64 = this.textBecomeImg(this.activeEleText)\r\n      const imageBlob = base64toBlob(imageBase64)\r\n      const link = document.createElement('a')\r\n      const event = document.createEvent('HTMLEvents')\r\n      // initEvent 不加后两个参数会在火狐下报错 事件类型，是否冒泡，是否阻止浏览器的默认行为\r\n      event.initEvent('click', true, true)\r\n      link.download = 'image.png'\r\n      link.href = URL.createObjectURL(imageBlob)\r\n      // 兼容火狐\r\n      link.dispatchEvent(new MouseEvent('click', { bubbles: true, cancelable: true, view: window }))\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\">\r\n@import \"../../assets/less/text-setting\";\r\n</style>\r\n"]}]}