{"remainingRequest":"D:\\projectWork\\thirdGrade\\econmic\\vue-admin-design\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\projectWork\\thirdGrade\\econmic\\vue-admin-design\\src\\views\\image\\ImageCompress.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\projectWork\\thirdGrade\\econmic\\vue-admin-design\\src\\views\\image\\ImageCompress.vue","mtime":1728976157741},{"path":"D:\\projectWork\\thirdGrade\\econmic\\vue-admin-design\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1728977241680},{"path":"D:\\projectWork\\thirdGrade\\econmic\\vue-admin-design\\node_modules\\babel-loader\\lib\\index.js","mtime":1728977243261},{"path":"D:\\projectWork\\thirdGrade\\econmic\\vue-admin-design\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1728977241680},{"path":"D:\\projectWork\\thirdGrade\\econmic\\vue-admin-design\\node_modules\\vue-loader\\lib\\index.js","mtime":1728977244061}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgSGludHMgZnJvbSAnQC9jb21wb25lbnRzL0hpbnRzJw0KaW1wb3J0IFVwbG9hZEltYWdlIGZyb20gJ0AvY29tcG9uZW50cy9VcGxvYWRJbWFnZScNCmltcG9ydCB7IGJhc2U2NHRvQmxvYiwgY2FsY0ltYWdlU2l6ZSB9IGZyb20gJ0AvdXRpbHMnDQpjb25zdCBxdWFsaXR5T3B0aW9ucyA9IFsNCiAgeyBsYWJlbDogMTAwLCB2YWx1ZTogMSB9LA0KICB7IGxhYmVsOiA5MCwgdmFsdWU6IDAuOSB9LA0KICB7IGxhYmVsOiA4MCwgdmFsdWU6IDAuOCB9LA0KICB7IGxhYmVsOiA3MCwgdmFsdWU6IDAuNyB9LA0KICB7IGxhYmVsOiA2MCwgdmFsdWU6IDAuNiB9LA0KICB7IGxhYmVsOiA1MCwgdmFsdWU6IDAuNSB9DQpdDQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ0ltYWdlQ29tcHJlc3MnLA0KICBjb21wb25lbnRzOiB7IEhpbnRzLCBVcGxvYWRJbWFnZSB9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICAvLyDlm77niYflr7nosaENCiAgICAgIGltYWdlOiB7DQogICAgICAgIHdpZHRoOiAxOTIwLA0KICAgICAgICBoZWlnaHQ6IDEwODAsDQogICAgICAgIHNyYzogJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9iYWltaW5neHVhbi9tZWRpYS1zdG9yZS9pbWFnZXMvaW1nMDMuanBnJw0KICAgICAgfSwNCiAgICAgIC8vIOWbvueJh+aYvuekuuWvueixoQ0KICAgICAgaW1hZ2VTaG93OiB7DQogICAgICAgIHdpZHRoOiAwLA0KICAgICAgICBoZWlnaHQ6IDAsDQogICAgICAgIGltZ1NyYzogJycNCiAgICAgIH0sDQogICAgICAvLyDlm77niYfljovnvKnnmoTlgLzlr7nosaENCiAgICAgIGltYWdlT2JqOiB7DQogICAgICAgIHdpZHRoOiAwLA0KICAgICAgICBoZWlnaHQ6IDAsDQogICAgICAgIHJhdGlvOiAxMDAgKyAnJScsDQogICAgICAgIHF1YWxpdHk6IDENCiAgICAgIH0sDQogICAgICBxdWFsaXR5T3B0aW9ucw0KICAgIH0NCiAgfSwNCiAgY29tcHV0ZWQ6IHsNCiAgICAvLyDlm77niYfmmL7npLrljLrmoLflvI8NCiAgICBpbWFnZVN0eWxlKCkgew0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgd2lkdGg6IHRoaXMuaW1hZ2VTaG93LndpZHRoICsgJ3B4JywNCiAgICAgICAgaGVpZ2h0OiB0aGlzLmltYWdlU2hvdy5oZWlnaHQgKyAncHgnLA0KICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6ICd1cmwoXCcnICsgdGhpcy5pbWFnZVNob3cuaW1nU3JjICsgJ1wnKScNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOWbvueJh+WuvemrmOavlOeOhw0KICAgIGltYWdlUmF0aW8oKSB7DQogICAgICByZXR1cm4gdGhpcy5pbWFnZS53aWR0aCAvIHRoaXMuaW1hZ2UuaGVpZ2h0DQogICAgfQ0KICB9LA0KICB3YXRjaDogew0KICAgIGltYWdlOiB7DQogICAgICBoYW5kbGVyKHZhbCkgew0KICAgICAgICB0aGlzLmdldERyYWdDb250YWluZXJTaXplKHZhbC53aWR0aCwgdmFsLmhlaWdodCkNCiAgICAgICAgdGhpcy5pbWFnZVNob3cuaW1nU3JjID0gdmFsLnNyYw0KICAgICAgICB0aGlzLmltYWdlT2JqLndpZHRoID0gdmFsLndpZHRoDQogICAgICAgIHRoaXMuaW1hZ2VPYmouaGVpZ2h0ID0gdmFsLmhlaWdodA0KICAgICAgICB0aGlzLmltYWdlT2JqLnJhdGlvID0gMTAwICsgJyUnDQogICAgICAgIHRoaXMuaW1hZ2VPYmoucXVhbGl0eSA9IDENCiAgICAgIH0sDQogICAgICBkZWVwOiB0cnVlDQogICAgfQ0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMuZ2V0RHJhZ0NvbnRhaW5lclNpemUodGhpcy5pbWFnZS53aWR0aCwgdGhpcy5pbWFnZS5oZWlnaHQpDQogICAgdGhpcy5pbWFnZVNob3cuaW1nU3JjID0gdGhpcy5pbWFnZS5zcmMNCiAgICB0aGlzLmltYWdlT2JqLndpZHRoID0gdGhpcy5pbWFnZS53aWR0aA0KICAgIHRoaXMuaW1hZ2VPYmouaGVpZ2h0ID0gdGhpcy5pbWFnZS5oZWlnaHQNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIC8vIOi+k+WFpeWuvemrmOWFs+iBlA0KICAgIGJpbmRJbnB1dCh0eXBlKSB7DQogICAgICBpZiAodHlwZSA9PT0gJ2gnKSB7DQogICAgICAgIHRoaXMuaW1hZ2VPYmouaGVpZ2h0ID0gTWF0aC5yb3VuZCh0aGlzLmltYWdlT2JqLndpZHRoIC8gdGhpcy5pbWFnZVJhdGlvKS50b0ZpeGVkKDApDQogICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICd3Jykgew0KICAgICAgICB0aGlzLmltYWdlT2JqLndpZHRoID0gTWF0aC5yb3VuZCh0aGlzLmltYWdlT2JqLmhlaWdodCAqIHRoaXMuaW1hZ2VSYXRpbykudG9GaXhlZCgwKQ0KICAgICAgfQ0KICAgICAgdGhpcy5pbWFnZU9iai5yYXRpbyA9ICh0aGlzLmltYWdlT2JqLndpZHRoIC8gdGhpcy5pbWFnZS53aWR0aCAqIDEwMCkudG9GaXhlZCgyKSArICclJw0KICAgIH0sDQogICAgLy8g6K6h566X5Zu+54mH5pi+56S65a696auYDQogICAgZ2V0RHJhZ0NvbnRhaW5lclNpemUoaW1hZ2VXLCBpbWFnZUgpIHsNCiAgICAgIGNvbnN0IFtzaG93QXJlYVcsIHNob3dBcmVhSF0gPSBbODUwLCA1NTBdDQogICAgICBjb25zdCBzaXplT2JqID0gY2FsY0ltYWdlU2l6ZShpbWFnZVcsIGltYWdlSCwgc2hvd0FyZWFXLCBzaG93QXJlYUgpDQogICAgICAvLyDmm7TmlrDlm77niYflsZXnpLrljLrlrr3pq5gNCiAgICAgIHRoaXMuaW1hZ2VTaG93LndpZHRoID0gc2l6ZU9iai53aWR0aA0KICAgICAgdGhpcy5pbWFnZVNob3cuaGVpZ2h0ID0gc2l6ZU9iai5oZWlnaHQNCiAgICB9LA0KICAgIGhhbmRsZVN1Y2Nlc3MoZGF0YSkgew0KICAgICAgdGhpcy5pbWFnZS5zcmMgPSBkYXRhDQogICAgICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpDQogICAgICBpbWFnZS5zcmMgPSBkYXRhDQogICAgICBpbWFnZS5vbmxvYWQgPSAoKSA9PiB7DQogICAgICAgIHRoaXMuaW1hZ2Uud2lkdGggPSBpbWFnZS53aWR0aA0KICAgICAgICB0aGlzLmltYWdlLmhlaWdodCA9IGltYWdlLmhlaWdodA0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g5Zu+54mH5Y6L57ypDQogICAgY29tcHJlc3NJbWFnZSgpIHsNCiAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy5pbWFnZU9iai53aWR0aA0KICAgICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5pbWFnZU9iai5oZWlnaHQNCiAgICAgIGNvbnN0IHF1YWxpdHkgPSB0aGlzLmltYWdlT2JqLnF1YWxpdHkNCiAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpDQogICAgICBpbWcuc3JjID0gdGhpcy5pbWFnZS5zcmMNCiAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7DQogICAgICAgIC8vIOWIm+W7umNhbnZhcw0KICAgICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKQ0KICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKQ0KICAgICAgICAvLyDliJvlu7rlsZ7mgKfoioLngrkNCiAgICAgICAgY29uc3QgYW53ID0gZG9jdW1lbnQuY3JlYXRlQXR0cmlidXRlKCd3aWR0aCcpDQogICAgICAgIGFudy5ub2RlVmFsdWUgPSB3aWR0aA0KICAgICAgICBjb25zdCBhbmggPSBkb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoJ2hlaWdodCcpDQogICAgICAgIGFuaC5ub2RlVmFsdWUgPSBoZWlnaHQNCiAgICAgICAgY2FudmFzLnNldEF0dHJpYnV0ZU5vZGUoYW53KQ0KICAgICAgICBjYW52YXMuc2V0QXR0cmlidXRlTm9kZShhbmgpDQogICAgICAgIC8vIOe7mOWItuWbvueJhw0KICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCkNCiAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDAsIHdpZHRoLCBoZWlnaHQpDQogICAgICAgIC8vIOeUn+aIkGJhc2U2NOWbvueJhw0KICAgICAgICBjb25zdCBpbWFnZUJhc2U2NCA9IGNhbnZhcy50b0RhdGFVUkwoJ2ltYWdlL3BuZycsIHF1YWxpdHkpDQogICAgICAgIHRoaXMuZG93bmxvYWRJbWFnZShpbWFnZUJhc2U2NCkNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOS4i+i9veWOi+e8qeeahOWbvueJhw0KICAgIGRvd25sb2FkSW1hZ2UoaW1hZ2VCYXNlNjQpIHsNCiAgICAgIGNvbnN0IGltYWdlQmxvYiA9IGJhc2U2NHRvQmxvYihpbWFnZUJhc2U2NCkNCiAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJykNCiAgICAgIGNvbnN0IGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0hUTUxFdmVudHMnKQ0KICAgICAgLy8gaW5pdEV2ZW50IOS4jeWKoOWQjuS4pOS4quWPguaVsOS8muWcqOeBq+eLkOS4i+aKpemUmSDkuovku7bnsbvlnovvvIzmmK/lkKblhpLms6HvvIzmmK/lkKbpmLvmraLmtY/op4jlmajnmoTpu5jorqTooYzkuLoNCiAgICAgIGV2ZW50LmluaXRFdmVudCgnY2xpY2snLCB0cnVlLCB0cnVlKQ0KICAgICAgbGluay5kb3dubG9hZCA9ICdpbWFnZS5wbmcnDQogICAgICBsaW5rLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGltYWdlQmxvYikNCiAgICAgIC8vIOWFvOWuueeBq+eLkA0KICAgICAgbGluay5kaXNwYXRjaEV2ZW50KG5ldyBNb3VzZUV2ZW50KCdjbGljaycsIHsgYnViYmxlczogdHJ1ZSwgY2FuY2VsYWJsZTogdHJ1ZSwgdmlldzogd2luZG93IH0pKQ0KICAgIH0NCiAgfQ0KfQ0K"},{"version":3,"sources":["ImageCompress.vue"],"names":[],"mappings":";AA6DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ImageCompress.vue","sourceRoot":"src/views/image","sourcesContent":["<template>\r\n  <div class=\"image-compress\">\r\n    <Hints>\r\n      <template slot=\"hintName\">图片压缩</template>\r\n      <template slot=\"hintInfo\">\r\n        <p>纯JS实现对图片的等比压缩和放大的功能，并对图片进行下载</p>\r\n      </template>\r\n    </Hints>\r\n    <el-row :gutter=\"20\">\r\n      <el-col :span=\"16\">\r\n        <el-card shadow=\"always\">\r\n          <div slot=\"header\" class=\"title\">图片区域</div>\r\n          <div class=\"box-wrapper\">\r\n            <div class=\"image-container\" :style=\"imageStyle\" />\r\n          </div>\r\n        </el-card>\r\n      </el-col>\r\n      <el-col :span=\"8\">\r\n        <el-card shadow=\"always\">\r\n          <div slot=\"header\" class=\"title\">设置区域</div>\r\n          <div class=\"box-content\">\r\n            <el-form label-width=\"82px\" label-position=\"left\">\r\n              <el-form-item label=\"选择图片：\">\r\n                <UploadImage class=\"select-image\" btn-name=\"选择图片\" @on-success=\"handleSuccess\" />\r\n              </el-form-item>\r\n              <el-form-item label=\"图片尺寸：\">\r\n                <div class=\"ratio-size\">\r\n                  <el-input v-model.number=\"imageObj.width\" @keyup.native=\"bindInput('h')\" />\r\n                  <i class=\"vue-dsn-icon-edit-img-size-locking icon-link\" />\r\n                  <el-input v-model.number=\"imageObj.height\" @keyup.native=\"bindInput('w')\" />\r\n                  <ul class=\"ratio-type clearfix\">\r\n                    <li>宽</li>\r\n                    <li>高</li>\r\n                  </ul>\r\n                </div>\r\n              </el-form-item>\r\n              <el-form-item label=\"压缩比例：\" class=\"item-ratio\">\r\n                <el-input v-model.number=\"imageObj.ratio\" disabled />\r\n              </el-form-item>\r\n              <el-form-item label=\"图片质量：\">\r\n                <el-select v-model=\"imageObj.quality\" placeholder=\"请选择\">\r\n                  <el-option\r\n                    v-for=\"item in qualityOptions\"\r\n                    :key=\"item.value\"\r\n                    :label=\"item.label\"\r\n                    :value=\"item.value\"\r\n                  />\r\n                </el-select>\r\n              </el-form-item>\r\n              <div>\r\n                <el-button class=\"btn-compress\" type=\"primary\" @click=\"compressImage\">压缩图片</el-button>\r\n              </div>\r\n            </el-form>\r\n          </div>\r\n        </el-card>\r\n      </el-col>\r\n    </el-row>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Hints from '@/components/Hints'\r\nimport UploadImage from '@/components/UploadImage'\r\nimport { base64toBlob, calcImageSize } from '@/utils'\r\nconst qualityOptions = [\r\n  { label: 100, value: 1 },\r\n  { label: 90, value: 0.9 },\r\n  { label: 80, value: 0.8 },\r\n  { label: 70, value: 0.7 },\r\n  { label: 60, value: 0.6 },\r\n  { label: 50, value: 0.5 }\r\n]\r\n\r\nexport default {\r\n  name: 'ImageCompress',\r\n  components: { Hints, UploadImage },\r\n  data() {\r\n    return {\r\n      // 图片对象\r\n      image: {\r\n        width: 1920,\r\n        height: 1080,\r\n        src: 'https://cdn.jsdelivr.net/gh/baimingxuan/media-store/images/img03.jpg'\r\n      },\r\n      // 图片显示对象\r\n      imageShow: {\r\n        width: 0,\r\n        height: 0,\r\n        imgSrc: ''\r\n      },\r\n      // 图片压缩的值对象\r\n      imageObj: {\r\n        width: 0,\r\n        height: 0,\r\n        ratio: 100 + '%',\r\n        quality: 1\r\n      },\r\n      qualityOptions\r\n    }\r\n  },\r\n  computed: {\r\n    // 图片显示区样式\r\n    imageStyle() {\r\n      return {\r\n        width: this.imageShow.width + 'px',\r\n        height: this.imageShow.height + 'px',\r\n        backgroundImage: 'url(\\'' + this.imageShow.imgSrc + '\\')'\r\n      }\r\n    },\r\n    // 图片宽高比率\r\n    imageRatio() {\r\n      return this.image.width / this.image.height\r\n    }\r\n  },\r\n  watch: {\r\n    image: {\r\n      handler(val) {\r\n        this.getDragContainerSize(val.width, val.height)\r\n        this.imageShow.imgSrc = val.src\r\n        this.imageObj.width = val.width\r\n        this.imageObj.height = val.height\r\n        this.imageObj.ratio = 100 + '%'\r\n        this.imageObj.quality = 1\r\n      },\r\n      deep: true\r\n    }\r\n  },\r\n  created() {\r\n    this.getDragContainerSize(this.image.width, this.image.height)\r\n    this.imageShow.imgSrc = this.image.src\r\n    this.imageObj.width = this.image.width\r\n    this.imageObj.height = this.image.height\r\n  },\r\n  methods: {\r\n    // 输入宽高关联\r\n    bindInput(type) {\r\n      if (type === 'h') {\r\n        this.imageObj.height = Math.round(this.imageObj.width / this.imageRatio).toFixed(0)\r\n      } else if (type === 'w') {\r\n        this.imageObj.width = Math.round(this.imageObj.height * this.imageRatio).toFixed(0)\r\n      }\r\n      this.imageObj.ratio = (this.imageObj.width / this.image.width * 100).toFixed(2) + '%'\r\n    },\r\n    // 计算图片显示宽高\r\n    getDragContainerSize(imageW, imageH) {\r\n      const [showAreaW, showAreaH] = [850, 550]\r\n      const sizeObj = calcImageSize(imageW, imageH, showAreaW, showAreaH)\r\n      // 更新图片展示区宽高\r\n      this.imageShow.width = sizeObj.width\r\n      this.imageShow.height = sizeObj.height\r\n    },\r\n    handleSuccess(data) {\r\n      this.image.src = data\r\n      const image = new Image()\r\n      image.src = data\r\n      image.onload = () => {\r\n        this.image.width = image.width\r\n        this.image.height = image.height\r\n      }\r\n    },\r\n    // 图片压缩\r\n    compressImage() {\r\n      const width = this.imageObj.width\r\n      const height = this.imageObj.height\r\n      const quality = this.imageObj.quality\r\n      const img = new Image()\r\n      img.src = this.image.src\r\n      img.onload = () => {\r\n        // 创建canvas\r\n        const canvas = document.createElement('canvas')\r\n        const ctx = canvas.getContext('2d')\r\n        // 创建属性节点\r\n        const anw = document.createAttribute('width')\r\n        anw.nodeValue = width\r\n        const anh = document.createAttribute('height')\r\n        anh.nodeValue = height\r\n        canvas.setAttributeNode(anw)\r\n        canvas.setAttributeNode(anh)\r\n        // 绘制图片\r\n        ctx.fillRect(0, 0, width, height)\r\n        ctx.drawImage(img, 0, 0, width, height)\r\n        // 生成base64图片\r\n        const imageBase64 = canvas.toDataURL('image/png', quality)\r\n        this.downloadImage(imageBase64)\r\n      }\r\n    },\r\n    // 下载压缩的图片\r\n    downloadImage(imageBase64) {\r\n      const imageBlob = base64toBlob(imageBase64)\r\n      const link = document.createElement('a')\r\n      const event = document.createEvent('HTMLEvents')\r\n      // initEvent 不加后两个参数会在火狐下报错 事件类型，是否冒泡，是否阻止浏览器的默认行为\r\n      event.initEvent('click', true, true)\r\n      link.download = 'image.png'\r\n      link.href = URL.createObjectURL(imageBlob)\r\n      // 兼容火狐\r\n      link.dispatchEvent(new MouseEvent('click', { bubbles: true, cancelable: true, view: window }))\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\">\r\n@import \"../../assets/less/image-compress\";\r\n</style>\r\n"]}]}